{
  "hash": "bb71368a48013ac6f3195e2614f6a63c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Vérifier l'installation de ffmpeg pour utiliser Whisper [Maj]\"\n\ncategories:\n  - Python\n  - Whisper\n  \nauthor: \n  - name: \"Marc Thévenin\"\n    affiliations:\n      - name: \"Ined\"\n\ndate: 10/20/2023\n\nimage: \"https://www.pngall.com/wp-content/uploads/2016/05/Python-Logo-PNG-Picture.png\"\n\nformat: \n  html: default\n\nabstract: | \n Le paquet de retranscription d'un fichier audio Whisper demande l'installation de l'encodeur vidéo **ffmpeg**. Même installé, le chemin d'accès de ffmpeg doit être impérativement présent dans les variables d'environnement.\n---\n\n- Première version de la fiche: 29 Juin 2023\n- Maj 20 octobre 2023: problème de compatibilité entre les dernières versions de Python et Whisper \n\n\n::: callout-note\n\n## Compatibilité entre les versions de Python et Whisper\n\nLors d'une assistance d'installation (10-10-23), il est apparu que la dernière version de python 1.12 n'était pas compatible avec la dernière version de Whisper. Cela sera certainement résolu prochainement, mais si un message d'erreur apparait lors de l'importation de Whisper `import whisper`, \n\nPour cette fiche, la version de Python utilisée est la 1.10. Lors de l'assistance d'installation en octobre nous avons donc du installer la version de Python 1.10.\n\nVous pouvez indiquer la présence de message d'erreur lors de l'importation de la librarie dans la zône de discussion.\n\n:::\n\n\n\n- [Tutoriel d'installation de whisper](https://github.com/openai/whisper)\n\n- Message d'erreur indiquant un problème d'installation de ffmpeg: **`FileNotFoundError: [WinError 2] Le fichier spécifié est introuvable`**\n\n- [MAJ 20 octobre 2023] Pour installer ffmpeg, je conseille de récupérer directement l'archive avec les exécutables, par exemple: [ffmpeg-git-essentials.7z.ver .sha256](https://www.gyan.dev/ffmpeg/builds/)\n\n- Vérifier la bonne installation de ffmpeg:\n   - Ouvrir l'invite de commande windows (taper `cmd` dans la barre de tâche)\n   - taper `ffmpeg` dans la console\n   - Si le message renvoyé indique que **ffmpeg n’est pas reconnu en tant que commande interne**, soit l'encodeur n'est pas installé, soit il est installé mais le chemin d'accès n'a pas été ajouté aux variables d'environnement.\n   - pour ajouter une variable d'environnement: \n\n\n\n{{< youtube M2BWTJXDJXY >}} \n\n\n\n\n- Vérifier de nouveau la bonne installation de ffmpeg (relancer l'invite de commande windows avant)\n\n::: {#ad896cd7 .cell execution_count=1}\n``` {.python .cell-code}\nimport whisper\n\n\nmodel = whisper.load_model(\"base\")\nresult = model.transcribe(\"mlk.mp3\",  verbose = True)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nC:\\Users\\thevenin_m\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\whisper\\transcribe.py:126: UserWarning:\n\nFP16 is not supported on CPU; using FP32 instead\n\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nDetecting language using up to the first 30 seconds. Use `--language` to specify the language\nDetected language: English\n[00:00.000 --> 00:03.000]  Something is happening in our world.\n[00:03.000 --> 00:07.000]  The masses of people are rising up.\n[00:09.000 --> 00:13.000]  And wherever they are to symbol today,\n[00:13.000 --> 00:17.000]  whether they are in Johannesburg, South Africa,\n[00:17.000 --> 00:24.000]  Nairobi, Kenya, a crore gun, a New York City, Atlanta, Georgia, Jackson, Mississippi,\n[00:24.000 --> 00:30.000]  a Memphis, Tennessee that cries always the same, we want to be free.\n```\n:::\n:::\n\n\n- Je conseille ce document pour une utilisation pleine et entière de Whisper, avec enregistrement d'un fichier texte de la retranscription: [tutoriel Cnrs](https://www.css.cnrs.fr/whisper-pour-retranscrire-des-entretiens/)\n\n\n::: callout-tip\n\n## Installation de ffmpeg à  l'Ined\n\n- Envisager avec le service informatique d'installer automatiquement  ffmpeg via **applined**\n- Il est fort possible de devoir utiliser votre compte administrateur pour ajouter le chemin d'accès à l'exécutable aux variables environnement\n\n:::\n\n\n::: callout-warning\n\n## Comment installer ffmpeg manuellement\n\nPour éviter une installation qui nécessite un autre outil d'installation (scoop,...), la méthode traditionnelle qui consiste à télécharger une archive 7z (<https://www.gyan.dev/ffmpeg/builds/>), décompresser le sous répertoire **bin**  dans le user du C, fonctionne toujours très bien. C'est ce chemin qu'il faudra ajouter aux variables d'environnement. \n\nPour ce genre d'outils, on peut créer dans son user un répertoire **PATH_EXE** et ici créer un sous répertoire **ffmpeg** dans lequel on mettra le bin.\n\n:::\n\n",
    "supporting": [
      "whisper_files"
    ],
    "filters": [],
    "includes": {}
  }
}