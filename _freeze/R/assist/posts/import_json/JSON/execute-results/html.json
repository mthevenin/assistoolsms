{
  "hash": "15445e22f20b7e9791299756f3688cf9",
  "result": {
    "markdown": "---\ntitle: \"Importer un format JSON\"\n\n# subtitle: \"\"\n\ncategories:\n  - importation\n  \nauthor: \n  - name: \"Arno Muller\"\n    affiliations:\n      - name: \"Ined\"\n\ndate: 06/28/2023\n\nimage: \"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/JSON_vector_logo.svg/langfr-1024px-JSON_vector_logo.svg.png\"\n\nformat: \n  html: default\n  docx: default\n#  pdf:  default\n\nfilters:\n  - lightbox\nlightbox: auto\n\ncode-annotations: below\n\nabstract: | \n Le format JSON est un format de plus en plus utilisé pour stocker des données, notamment pour les données issues du web. Cependant, sa structure particulière peut poser des problèmes pour obtenir un dataframe dans R.\n---\n\n\n\n# Introduction\n\n\nPour importer des données au format JSON, nous proposons deux packages `rjson` et `jsonlite`.\nLe dernier est beaucoup plus facile d'utilisation et renvoie automatiquement une base de donnée faites de colonnes.\nJe propose `rjson` comme une alternative à `jsonlite` en cas de pépin.\n\n\n# Données d'exemples\n\nLe format JSON est surtout utilisé pour les données issues d'API web ou de source OpenData.\nPour les exemples ci-dessous nous utiliserons donc des données issues du site de la SNCF qui mettent à disposition un grand nombre de jeux de données en libre accès, et notamment dans notre cas, une **base de données des menus des wagons-bars de TGV**[^1].\n\n[^1]: <https://ressources.data.sncf.com/explore/dataset/menus-des-bars-tgv/table/>\n\n# Importer des données avec `jsonlite`\n\n\n\n::: {.cell filename='Package jsonlite'}\n\n```{.r .cell-code}\nlibrary(jsonlite)\nmenu_TGV <- jsonlite::fromJSON(\"DATA/menus-des-bars-tgv.json\")\n\n# Pour voir les 3 premières lignes\nlibrary(knitr)\nkable(head(menu_TGV,3))\n```\n\n::: {.cell-output-display}\n|date_debut |date_fin   |produit                     | prix_au_produit|type                 |categorie_produit |presence_de_porc |presence_d_alcool |composants                                                                                                                                                                                                                                         |allergenes |allergenes_susceptibles_de_provenir_de_contaminations_croisees                                                  | kcal_pour_100_ml_ou_100g|recette_vegetarienne |recette_vegane |bio |sans_gluten | poids_g_cl| proteines_100g_100ml| glucides_100g_100ml| lipides_100g_100ml|\n|:----------|:----------|:---------------------------|---------------:|:--------------------|:-----------------|:----------------|:-----------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------|:---------------------------------------------------------------------------------------------------------------|------------------------:|:--------------------|:--------------|:---|:-----------|----------:|--------------------:|-------------------:|------------------:|\n|2023-06-22 |2023-10-12 |Café lungo, Illy            |             2.9|Thé, café & chocolat |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica                                                                                                                                                                                          |NA         |NA                                                                                                              |                        4|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n|2023-06-22 |2023-10-12 |Cappuccino grand, Illy      |             4.9|Boissons gourmandes  |Boissons          |NON              |NON               |2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre), capsule de 14,5 g de café 100% Arabica, chocolat (chocolat en poudre 59.4% (sucre, cacao 32% minimum), lait écrémé en poudre 38.5%, lactose, antiagglomérant (E551), sel, arôme) |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |                       NA|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n|2023-06-22 |2023-10-12 |Latte Macchiato grand, Illy |             4.9|Boissons gourmandes  |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica, 2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre)                                                                                                                        |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |                       NA|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n:::\n:::\n\n\n\n# Importer des données avec `rjson`\n\n\n\n::: {.cell filename='Package rjson'}\n\n```{.r .cell-code}\nlibrary(rjson)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttachement du package : 'rjson'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLes objets suivants sont masqués depuis 'package:jsonlite':\n\n    fromJSON, toJSON\n```\n:::\n\n```{.r .cell-code}\nmenu_TGV <- rjson::fromJSON(file = \"DATA/menus-des-bars-tgv.json\")\nclass(menu_TGV)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"list\"\n```\n:::\n:::\n\n\nOn obtient un objet de type `list` [^2], que l'on peut transformer en base de donnée avec l'exemple suivant.  \n\n[^2]: Pour découvrir comment utiliser des listes : <https://juba.github.io/tidyverse/16-structures-donnees.html#sec-listes>\n\n\nUne liste peut-être un objet assez complexe mais en fouillant dedans, il est possible de retrouver (ou de mettre en forme) une base de donnée.\nDans notre cas plutôt simple, on remarque que la liste a autant d'élément que d'individus, et lorsqu'on regarde à l'intérieur de chaque élément, on trouve la réponse pour chaque individu à chacune des variables.\n\n\n![](img/liste_explic.png){width=\"75%\"}\n\n\nOn va donc extraire ces informations et les compiler dans une base de donnée ordonnées.\n\n\n\n::: {.cell filename='Convertir une liste'}\n\n```{.r .cell-code}\n# Convertir la liste en data frame par lignes\nmenu_df <- as.data.frame(do.call(rbind, menu_TGV))\nkable(head(menu_df,3))\n```\n\n::: {.cell-output-display}\n|date_debut |date_fin   |produit                     |prix_au_produit |type                 |categorie_produit |presence_de_porc |presence_d_alcool |composants                                                                                                                                                                                                                                         |allergenes |allergenes_susceptibles_de_provenir_de_contaminations_croisees                                                  |kcal_pour_100_ml_ou_100g |recette_vegetarienne |recette_vegane |bio |sans_gluten |poids_g_cl |proteines_100g_100ml |glucides_100g_100ml |lipides_100g_100ml |\n|:----------|:----------|:---------------------------|:---------------|:--------------------|:-----------------|:----------------|:-----------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------|:---------------------------------------------------------------------------------------------------------------|:------------------------|:--------------------|:--------------|:---|:-----------|:----------|:--------------------|:-------------------|:------------------|\n|2023-06-22 |2023-10-12 |Café lungo, Illy            |2.9             |Thé, café & chocolat |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica                                                                                                                                                                                          |NULL       |NULL                                                                                                            |4                        |NON                  |NON            |NON |NON         |NULL       |NULL                 |NULL                |NULL               |\n|2023-06-22 |2023-10-12 |Cappuccino grand, Illy      |4.9             |Boissons gourmandes  |Boissons          |NON              |NON               |2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre), capsule de 14,5 g de café 100% Arabica, chocolat (chocolat en poudre 59.4% (sucre, cacao 32% minimum), lait écrémé en poudre 38.5%, lactose, antiagglomérant (E551), sel, arôme) |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |NULL                     |NON                  |NON            |NON |NON         |NULL       |NULL                 |NULL                |NULL               |\n|2023-06-22 |2023-10-12 |Latte Macchiato grand, Illy |4.9             |Boissons gourmandes  |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica, 2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre)                                                                                                                        |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |NULL                     |NON                  |NON            |NON |NON         |NULL       |NULL                 |NULL                |NULL               |\n:::\n\n```{.r .cell-code}\n# Même chose avec le package data.table\nlibrary(data.table)\nmenu_df2 <- rbindlist(menu_TGV)\nkable(head(menu_df2,3))\n```\n\n::: {.cell-output-display}\n|date_debut |date_fin   |produit                     | prix_au_produit|type                 |categorie_produit |presence_de_porc |presence_d_alcool |composants                                                                                                                                                                                                                                         |allergenes |allergenes_susceptibles_de_provenir_de_contaminations_croisees                                                  | kcal_pour_100_ml_ou_100g|recette_vegetarienne |recette_vegane |bio |sans_gluten | poids_g_cl| proteines_100g_100ml| glucides_100g_100ml| lipides_100g_100ml|\n|:----------|:----------|:---------------------------|---------------:|:--------------------|:-----------------|:----------------|:-----------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------|:---------------------------------------------------------------------------------------------------------------|------------------------:|:--------------------|:--------------|:---|:-----------|----------:|--------------------:|-------------------:|------------------:|\n|2023-06-22 |2023-10-12 |Café lungo, Illy            |             2.9|Thé, café & chocolat |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica                                                                                                                                                                                          |NA         |NA                                                                                                              |                        4|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n|2023-06-22 |2023-10-12 |Cappuccino grand, Illy      |             4.9|Boissons gourmandes  |Boissons          |NON              |NON               |2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre), capsule de 14,5 g de café 100% Arabica, chocolat (chocolat en poudre 59.4% (sucre, cacao 32% minimum), lait écrémé en poudre 38.5%, lactose, antiagglomérant (E551), sel, arôme) |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |                       NA|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n|2023-06-22 |2023-10-12 |Latte Macchiato grand, Illy |             4.9|Boissons gourmandes  |Boissons          |NON              |NON               |Capsule de 6,5 g de café moulu illy, mélange 100% Arabica, 2 Capsules de 15g de lait (lait entier, sirop de glucose, sucre)                                                                                                                        |Lactose    |Arachides, amandes, noix, soja, oeufs, poissons, crustaces, sésame, céréales, sulfites, lupin, céleri, moutarde |                       NA|NON                  |NON            |NON |NON         |         NA|                   NA|                  NA|                 NA|\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}