{
  "hash": "44c23d7f6036eb6c02e9e029df342697",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Fonction pour des tables automatiques\"\n\ncategories:\n  - Statistiques descriptives\n  - Tableau\n  \nauthor: \n  - name: \"Arno Muller\"\n    affiliations:\n      - name: \"Ined\"\n\ndate: 06/30/2023\n\nimage: \"https://www.r-project.org/Rlogo.png\"\n\nformat: \n  html: default\n#  docx: default\n\nfilters:\n  - lightbox\n\nlightbox: auto\n\nabstract: | \n Après avoir explorer des données, on peut vouloir compiler nos tables dans un même objet et l'exporter dans Excel pour les mettre en forme selon ses goûts. Il est possible d'automatiser le processus sur R.\n---\n\n\n# Introduction\n\nIl existe un large éventail de package R consacré à la gestion et la mise en forme de table et de tris croisés (`GT`, `flextable`, ...). S'ils sont souvent de grandes qualités, leur coût d'entrée peut être un peu élevé pour les utilisateurs.rices occasionnelles de R.\n\nPour répondre aux besoins de ces derniers, vous trouverez ici une fonction qui permet de facilement compiler des tris à plats ou bivariées, pour explorer automatiquement un grand nombre de variables, utiliser une pondération et les exporter dans un document Excel.\n\nPour une introduction aux tables et à la pondération, voir la [fiche](https://mthevenin.github.io/assistoolsms/R/assist/posts/weight_norm/weight_norm.html)\n\n## Données d'exemples\n\nPour illustrer la mise en oeuvre de la fonction, on utilise les données d'exemples *hdv2003* du packages `questionr`. Ces données possèdent à la fois des variables sur des carastéristiques socio-démographiques, des pratiques et des goûts, et propose une variable de pondération : *poids*.\n\n\n::: {.cell filename='Importation des données d\\'exemples'}\n\n```{.r .cell-code}\nlibrary(questionr)\ndata(\"hdv2003\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; \"><table class=\"table table-striped\" style=\"font-size: 11px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> id </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> age </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> sexe </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> nivetud </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> poids </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> occup </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:left;\"> Femme </td>\n   <td style=\"text-align:left;\"> Enseignement superieur y compris technique superieur </td>\n   <td style=\"text-align:right;\"> 2634.398 </td>\n   <td style=\"text-align:left;\"> Exerce une profession </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:left;\"> Femme </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> 9738.396 </td>\n   <td style=\"text-align:left;\"> Etudiant, eleve </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:left;\"> Homme </td>\n   <td style=\"text-align:left;\"> Derniere annee d'etudes primaires </td>\n   <td style=\"text-align:right;\"> 3994.102 </td>\n   <td style=\"text-align:left;\"> Exerce une profession </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> Homme </td>\n   <td style=\"text-align:left;\"> Enseignement superieur y compris technique superieur </td>\n   <td style=\"text-align:right;\"> 5731.662 </td>\n   <td style=\"text-align:left;\"> Exerce une profession </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:left;\"> Femme </td>\n   <td style=\"text-align:left;\"> Derniere annee d'etudes primaires </td>\n   <td style=\"text-align:right;\"> 4329.094 </td>\n   <td style=\"text-align:left;\"> Retraite </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 35 </td>\n   <td style=\"text-align:left;\"> Femme </td>\n   <td style=\"text-align:left;\"> Enseignement technique ou professionnel court </td>\n   <td style=\"text-align:right;\"> 8674.699 </td>\n   <td style=\"text-align:left;\"> Exerce une profession </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n\n\n## Objectifs :\n\n-   Obtenir une table automatique avec les tris à plat d'un grand nombre de variables\n-   Croiser ces variables avec une variable choisie, par exemple le sexe ou la qualification et obtenir :\n    -   Les effectifs\n    -   Les pourcentages lignes\n    -   Les poucentages colonnes\n    -   Ajout d'un test du chi²\n-   Utiliser des pondérations\n-   Garder ou non les valeurs manquantes\n-   Exporter le tableau obtenu (Par exemple : image ci-dessous)\n\n![](img/ex_table.png){width=\"50%\"}\n\n# Mise en oeuvre\n \n## Fonctionnement\n\nOn utilise la fonction `table_auto()` qui ne fait partie d'aucun package, il faut donc la charger dans un premier temps dans R. Une fois la fonction chargée, il suffira de la lancer en renseignant les variables, et les options voulues (présence de valeurs manquantes, pondérations, exportation)\n\n## Paramètre de la fonction\n\n+-----------------+--------------------------------------------------------------+\n| Paramètre       | Argument                                                     |\n+=================+==============================================================+\n| **donnees**     | Une base de données                                          |\n+-----------------+--------------------------------------------------------------+\n| **vars**        | Un vecteur avec les différentes variables en lignes          |\n+-----------------+--------------------------------------------------------------+\n| **var_crois**   | -   Si vide : Tris à plat                                    |\n|                 |                                                              |\n|                 | -   Si une variable : Tris croisés                           |\n+-----------------+--------------------------------------------------------------+\n| **table_type**  | -   Effectifs : \"eff\"                                        |\n|                 |                                                              |\n|                 | -   Pourcentage ligne : \"pct_ligne\"                          |\n|                 |                                                              |\n|                 | -   Pourcentage colonne : \"pct_col\"                          |\n+-----------------+--------------------------------------------------------------+\n| **ponder**      | Une variable de pondération dans donnee                      |\n+-----------------+--------------------------------------------------------------+\n| **val.manq**    | \"oui\" ou \"non\", garder ou non les valeurs manquantes         |\n+-----------------+--------------------------------------------------------------+\n| **arrondi**     | Nombre de chiffre après la virgule                           |\n+-----------------+--------------------------------------------------------------+\n| **sautdeligne** | \"oui\" ou \"non\", insérer une ligne vide entre chaque variable |\n+-----------------+--------------------------------------------------------------+\n| **export_XLS**  | \"oui\" ou \"non\", si oui : création d'un fichier excel.        |\n+-----------------+--------------------------------------------------------------+\n\n## Import de la fonction `table_auto()`\n\nPour l'instant la fonction ne se trouve pas dans un package, il faut donc la charger dans l'environnement global de R depuis GitHub en utilisant le code suivant.  \n\n\n\n::: {.cell filename='Chargement de la fonction depuis Github'}\n\n```{.r .cell-code}\nsource(\"https://raw.githubusercontent.com/arnomuller/Fonction_R/main/table_auto/fonction_table_auto.R\")\n```\n:::\n\n\n\n![](img/import_fct.png){width=\"75%\"}\n\nLe code de la fonction est disponible [ici](https://github.com/arnomuller/table_auto), si vous souhaitez lui apparter des modifications pour l'adapter à vos besoins.\n\n## Choix des variables\n\nOn définit les variables à croiser :\n\n\n::: {.cell filename='Choix des variables'}\n\n```{.r .cell-code}\nvars      <- c(\"relig\",\"trav.imp\",\"trav.satisf\",\"hard.rock\",\n               \"lecture.bd\",\"peche.chasse\",\"cuisine\",\n               \"bricol\",\"cinema\",\"sport\")\n```\n:::\n\n\nOn peut également définir ici la variable de poids et celle à croiser, ou le faire directement dans la fonction.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# On croise avec la variable sexe\nvar_crois <- \"sexe\"\n# Si pas de croisement écrire NULL\nvar_crois <- NULL\n\n# Variable de pondération\nponder    <- \"poids\"\n# Si pas de pondération :\nponder    <- NULL\n```\n:::\n\n\n\n## Création du tableau empilé\n\nEn lançant le code suivant, on crée le data.frame **tabdesc**.\n\n\n::: {.cell filename='Activation de la fonction'}\n\n```{.r .cell-code}\ntable_auto(hdv2003,              # Base de données\n           vars,                 # Un vecteur avec les noms des variables\n           var_crois   = \"sexe\", # Variable à croiser, si NULL : tri à plat\n           table_type  = \"eff\",  # Type de table : \"eff\", \"pct_lign\", \"pct_col\"\n           ponder      = NULL,   # Variable de ponder. , si NULL: pas de poids\n           val.manq    = \"non\",  # Si \"oui\" avec valeurs manquantes\n           arrondi     = 4,      # Nb de chiffres après la virgule\n           sautdeligne = \"oui\",  # Sauter des lignes entre les variables\n           export_XLS  = \"non\")  # Si \"oui\" créer un excel : tableau_empilee\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; \"><table class=\"table table-striped\" style=\"font-size: 11px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Var </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Levels </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> ENSEMBLE </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Homme </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Femme </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> pvalue </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> ddl </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> danger </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> ENSEMBLE </td>\n   <td style=\"text-align:right;\"> 2000 </td>\n   <td style=\"text-align:right;\"> 899 </td>\n   <td style=\"text-align:right;\"> 1101 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> Pratiquant regulier </td>\n   <td style=\"text-align:right;\"> 266 </td>\n   <td style=\"text-align:right;\"> 86 </td>\n   <td style=\"text-align:right;\"> 180 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> Pratiquant occasionnel </td>\n   <td style=\"text-align:right;\"> 442 </td>\n   <td style=\"text-align:right;\"> 170 </td>\n   <td style=\"text-align:right;\"> 272 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> Appartenance sans pratique </td>\n   <td style=\"text-align:right;\"> 760 </td>\n   <td style=\"text-align:right;\"> 365 </td>\n   <td style=\"text-align:right;\"> 395 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> Ni croyance ni appartenance </td>\n   <td style=\"text-align:right;\"> 399 </td>\n   <td style=\"text-align:right;\"> 210 </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> Rejet </td>\n   <td style=\"text-align:right;\"> 93 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> relig </td>\n   <td style=\"text-align:left;\"> NSP ou NVPR </td>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:left;\"> 0,0000 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> trav.imp </td>\n   <td style=\"text-align:left;\"> Le plus important </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:left;\"> 0.0001 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}