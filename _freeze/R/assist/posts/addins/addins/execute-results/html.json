{
  "hash": "ead054b470cb6143a0e78dfff68d3dd2",
  "result": {
    "markdown": "---\ntitle: \"Produire des graphiques et recoder des variables sans écrire de code R\"\n\ndate: 07/10/2023\n\ncategories:\n  - Addins\n  - Graphique\n  - Recodage\n\nauthor: \n  - name: \"Bénédicte Garnier\"\n    affiliations:\n      - name: \"Ined\"\n\nimage: \"http://dreamrs.github.io/esquisse/logo.png\"\n\nfilters:\n   - lightbox\n   \nlightbox: auto\n\nabstract: |\n Rstudio possède des **Addins** qui permettent  d'exécuter des fonctions R de façon interactive. Le code généré peut être sauvegardé pour l'insérer dans ses scripts R. Nous illustrons notre propos ici avec les packages **esquisse** pour visualiser des données ou produire des graphiques simples  et **questionr** pour recoder des variables.\n\n---\n\n\n\n| Packages      | Fonctions |\n|---------------|-----------|\n| **esquisse**  | `ggplot2` |\n| **questionr** | `irec`    |\n\n: **Fonctions utilisées dans la fiche**\n\nDans cette fiche vous verrez comment utiliser des *Addins* associés à certains packages de R qui permettent de produire le code R de façon interactive pour :  \n\n- Générer des graphiques exploratoires [addins **esquisse**] \n- Recoder des variables [addins **questionr**]\n\nCes exemples s'inspire des fiches pédagogiques produites dans le cadre de [l'école d'été du Collège International des Sciences Territoriales](http://ee2023.netlify.app/).\n\nLe fichier utilisé ici contient 10% des individus de la table *Ménages* extraite de l'[enquête DHS](http://dhsprogram.com/) passée au Bénin en 2017 (vague 7).    \n\n\n**Documentation**:  \n\n-   [**RStudio Addins**](http://docs.posit.co/ide/user/ide/guide/productivity/add-ins.html) sont des extensions pour l'environnement de développement intégré (IDE) RStudio\n\n-   [**Débuter avec Esquisse**](http://cran.r-project.org/web/packages/esquisse/vignettes/get-started.html)\n\n-   Séminaire R à l'Usage des Sciences Sociales, [*Esquisse, moins tu sais coder plus tu vas rigoler*](http://russ.site.ined.fr/fr/annee-2022-2023/esquisse/)\n\n-   [**package questionr**](http://juba.github.io/questionr/articles/recoding_addins.html)\n\n\n**Installation des packages**\n\n```markdown\ninstall.packages(\"esquisse\")\ninstall.packages(\"questionr\")\n```\n\n\n# Addins esquisse\n\n\n\n::: {.cell filename='Chargement du package et des données P3_Menages'}\n\n```{.r .cell-code}\nlibrary(esquisse)\nload(\"datas/P3_Menages.RData\")\n```\n:::\n\n\n\nOn peut accéder à **esquisse** via le menu **Addins** de RStudio et en sélectionnant **ggplot2 builder**.\n\n![](img/img1.png){width=45%}\n\nOu directement par la console:\n\n```markdown\nesquisser()\n```\n\n## Chargement des données\n\nLorsque l'application est ouverte, on accède directement à la fenêtre de chargement des données. Ici, comme les données ont été chargée dans R, elles sont directement accessibles **`<\\>environnement`**.\n\n![](img/img2.png){width=50%}\n\nSélection et visualisation de la table à l'aide de l'onglet **View**.\n\n![](img/img3.png){width=50%}\n\nSous le nom de chaque variable, on peut voir son *type R* : *integer, factor, character*.\n\nOn peut visualiser les *modalités* associées aux variables avec le bouton **Data** (en bas de la fenêtre).\n\n![](img/img4.png){width=50%}\n\n## Production d'un graphique\n\nLa fenêtre d'esquisse permet de *choisir* les données à représenter et *propose un graphique* adapté au type de la variable dans R. Ici une ***box-plot***\n\n![](img/img5.png){width=50%}\n\nOn Sélectionne les variables par un **glisser/déposer** dans les zones correspondantes au paramétrage du graphique (x, y, fill, colors, size, ... du package ggplot2). \n\nLe rôle de ces options sont données en cliquant sur le bouton *display settings* qui se trouve en haut à droite de la fenêtre principale.\n\n![](img/img5b.png){width=50%}\n\n\nPour en savoir plus sur les graphiques à produire en fonction des données à représenter, on peut se reporter au site de Y. Holtz [From data to Viz](http://www.data-to-viz.com/).  \n\n\nPour l'exemple, on va représenter le nombre de ménages par pays d'enquête *hv000* avec un graphique en barres.\n\n![](img/img6.png){width=50%}\n\nSi on souhaite modifier orienter les barres à l'horizontal (recommandé) on va dans l'onglet **Plot options** puis on coche ***Flip coordinate***.\n\nOn utilise le bouton **Plot options** pour changer la disposition (ici barres horizontales).\n\n![](img/img7.png){width=50%}\n\nOn peut égalemet changer les titres du graphique dans l'onglet **Ad Labels & Titles**, et son apparence (couleurs, thème) dans l'onglet **Appearance**.\n\n::: {layout-ncol=2}\n\n![](img/img8.png)\n\n![](img/img9.png)\n\n:::\n\n\n## Exporter le code\n\nL'onglet **Code** affiche le code généré par l'application. On peut le récupérer par simple copier/coller\n\n![](img/img10.png){width=70%}\n\nComme l'interface ne permet pas de modifier la couleur du contour des barres, on peut le faire en modifiant légèrement le script. Après avoir collé le code du graphique dans un script, on ajoute par exemple à la fonction **`geom_bar()`** l'option `color=\"black\"`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(P3_Menages) +\n  aes(x = hv000) +\n  geom_bar(fill = \"#FF6992\", color=\"black\") +\n  labs(\n    x = \"Enquête\",\n    y = \"Nombre de ménages\",\n    title = \"Ménages par pays et vagues d'enquête\",\n    caption = \"Source: DHS 2017\"\n  ) +\n  coord_flip() +\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](addins_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\nL'animation qui suit résume les différentes étapes (cliquer sur l'image pour la faire redémarrer au début et l'agrandir)\n\n\n![](img/addins.gif){width=70%}\n\n\n# Addins de questionr\n\nDe la même façon, *questionr* permet de générer du code à partir du menu **Tools/Addins** de RStudio).\n\n### Préparation de l'environnement\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Appel du package questionr\nlibrary(questionr)\n# Si besoin, on charge la table à visualiser (ici P3_Menages)\n#load(\"datas/P3_Menages.RData\")\n```\n:::\n\n\n![](img/img11.png)\n\nOn accède à la fenêtre de recodage en cliquant sur **Levels recoding**. Par exemple pour la variable *Pays et vague de l'enquête (hv000)*. On peut modifier le nom et type de variable à générer (ici hv000_rec de type caractère).\n\n![](img/img11b.png){width=70%}\n\nOn change l'intitulé des modalités (bouton **Recodage**).\n\n![](img/img12.png){width=70%}\n\nOn génère le code et on visualise le résultat (bouton **Code et Résultat**).\n\n![](img/img13.png){width=70%}\n\nDe la même façon, on peut changer l'ordre des modalités d'une variable en sélectionnant l'Addin **Levels Ordering**.\n\n",
    "supporting": [
      "addins_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}