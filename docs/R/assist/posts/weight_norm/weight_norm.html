<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elodie Baril">

<title>Support Sms - Pondérations normalisées avec R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>


<link rel="stylesheet" href="../../../../sms.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Support Sms</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../R/index.html"> 
<span class="menu-text">R</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-othe-r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Othe-R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-othe-r">    
        <li>
    <a class="dropdown-item" href="../../../../Autres/index.html">
 <span class="dropdown-text">Quarto-Git-Python…</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../Stata/index.html">
 <span class="dropdown-text">Stata</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../supports.html"> 
<span class="menu-text">Autres Supports</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html"> 
<span class="menu-text"><i class="fa-solid fa-info-circle" aria-label="info-circle"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/mthevenin/assistoolsms"> 
<span class="menu-text"><i class="fa-brands fa-github" aria-label="github"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Pondérations normalisées avec R</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Pondération</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Auteur·rice</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Elodie Baril </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Ined
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">29 juin 2023</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Résumé</div>
      <p>L’utilisation des poids normalisés sur la taille de l’échantillon s’avère obligatoire pour certaines analyses, en particulier pour obtenir des estimations robustes de la variance. La présente fiche présente avec les packages <code>questionr</code> et <code>survey</code>, deux manières d’introduire ces poids dans des analyses.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#package-questionr" id="toc-package-questionr" class="nav-link active" data-scroll-target="#package-questionr">Package questionr</a>
  <ul class="collapse">
  <li><a href="#fréquences-pondérées" id="toc-fréquences-pondérées" class="nav-link" data-scroll-target="#fréquences-pondérées">Fréquences pondérées</a></li>
  <li><a href="#pourcentages-pondérés" id="toc-pourcentages-pondérés" class="nav-link" data-scroll-target="#pourcentages-pondérés">Pourcentages pondérés</a></li>
  </ul></li>
  <li><a href="#le-package-survey" id="toc-le-package-survey" class="nav-link" data-scroll-target="#le-package-survey">Le package <code>survey</code></a>
  <ul class="collapse">
  <li><a href="#création-de-la-variable-de-pondération-normalisée" id="toc-création-de-la-variable-de-pondération-normalisée" class="nav-link" data-scroll-target="#création-de-la-variable-de-pondération-normalisée">Création de la variable de pondération normalisée</a></li>
  <li><a href="#design-de-léchantillon" id="toc-design-de-léchantillon" class="nav-link" data-scroll-target="#design-de-léchantillon">Design de l’échantillon</a></li>
  <li><a href="#application-du-design-à-des-fonctions-analytiques" id="toc-application-du-design-à-des-fonctions-analytiques" class="nav-link" data-scroll-target="#application-du-design-à-des-fonctions-analytiques">Application du design à des fonctions analytiques</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<table class="table">
<caption><strong>Fonctions utilisées dans la fiche</strong></caption>
<thead>
<tr class="header">
<th>Package</th>
<th>Fonction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>questionr</strong></td>
<td><code>wtd.table</code> - <code>cprop</code> - <code>lprop</code></td>
</tr>
<tr class="even">
<td><strong>survey</strong></td>
<td><code>svydesign</code> - <code>svytable</code> - <code>svymean</code> - <code>svyglm</code></td>
</tr>
<tr class="odd">
<td><strong>Base R</strong></td>
<td><code>mean</code></td>
</tr>
</tbody>
</table>
<p>Documentation sur les packages:</p>
<ul>
<li><a href="https://juba.github.io/questionr/" class="uri">https://juba.github.io/questionr/</a></li>
<li><a href="https://www.rdocumentation.org/packages/survey/versions/4.1-1" class="uri">https://www.rdocumentation.org/packages/survey/versions/4.1-1</a></li>
</ul>
<p>Activation des packages et ouverture de la table d’exemple HDV</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#install.packages(questionr)</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#install.packages(survey)</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(questionr)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#Utilisation de la table d'exemple Histoire de vie (hdv2003) </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">data</span>(<span class="st">"hdv2003"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># Extrait du fichier</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>hdv2003[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id age  sexe                                              nivetud    poids
1  1  28 Femme Enseignement superieur y compris technique superieur 2634.398
2  2  23 Femme                                                 &lt;NA&gt; 9738.396
3  3  59 Homme                    Derniere annee d'etudes primaires 3994.102
4  4  34 Homme Enseignement superieur y compris technique superieur 5731.662
5  5  71 Femme                    Derniere annee d'etudes primaires 4329.094</code></pre>
</div>
</div>
<p>La variable pondérée du fichier s’appelle <strong>poids</strong></p>
<section id="package-questionr" class="level1">
<h1>Package questionr</h1>
<p>Le package <code>questionr</code> permet d’obtenir rapidement des tableaux de fréquences ou de pourcentages avec des poids normalisés. L’opération de normalisation est passée directement dans une option.</p>
<section id="fréquences-pondérées" class="level2">
<h2 class="anchored" data-anchor-id="fréquences-pondérées">Fréquences pondérées</h2>
<ul>
<li>Fonction <strong><code>wtd.table()</code></strong></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fréquences sans pondération</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">table</span>(hdv2003<span class="sc">$</span>sexe)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Homme Femme 
  899  1101 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fréquences avec pondérations</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># tris à plat avec l'option weights</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">wtd.table</span>(hdv2003<span class="sc">$</span>sexe, <span class="at">weights =</span> hdv2003<span class="sc">$</span>poids)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Homme   Femme 
5149382 5921844 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#  tris croisé</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">wtd.table</span>(hdv2003<span class="sc">$</span>qualif,hdv2003<span class="sc">$</span>sexe,<span class="at">weights=</span>hdv2003<span class="sc">$</span>poids)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             Homme     Femme
Ouvrier specialise        532365.8  479015.0
Ouvrier qualifie         1163988.6  296252.0
Technicien                378956.7  115658.0
Profession intermediaire  438737.8  375560.7
Cadre                     779354.9  623574.6
Employe                   525068.8 2591911.0
Autre                     129695.9  145912.6</code></pre>
</div>
</div>
<p><strong>Pour normaliser la pondération on ajoute l’option <code>normwt=TRUE</code></strong>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fréquences avec pondérations normalisées</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">wtd.table</span>(hdv2003<span class="sc">$</span>sexe,<span class="at">weights=</span>hdv2003<span class="sc">$</span>poids, <span class="at">normwt=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Homme    Femme 
 930.228 1069.772 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tri croisé avec pondérations normalisées</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">wtd.table</span>(hdv2003<span class="sc">$</span>qualif,hdv2003<span class="sc">$</span>sexe,<span class="at">weights=</span>hdv2003<span class="sc">$</span>poids, <span class="at">normwt=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                             Homme     Femme
Ouvrier specialise        96.17106  86.53332
Ouvrier qualifie         210.27275  53.51747
Technicien                68.45794  20.89344
Profession intermediaire  79.25731  67.84446
Cadre                    140.78927 112.64780
Employe                   94.85286 468.22473
Autre                     23.42937  26.35888</code></pre>
</div>
</div>
</section>
<section id="pourcentages-pondérés" class="level2">
<h2 class="anchored" data-anchor-id="pourcentages-pondérés">Pourcentages pondérés</h2>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Stocker le resultat des fréquences pondérées dans un objet, ici res</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>res<span class="ot">=</span><span class="fu">wtd.table</span>(hdv2003<span class="sc">$</span>qualif,hdv2003<span class="sc">$</span>sexe, <span class="at">weights=</span>hdv2003<span class="sc">$</span>poids, <span class="at">normwt=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<ul>
<li>On utilise les fonctions <code>cprop()</code> et <code>lprop</code>:
<ul>
<li>cprop(): pourcentages colonnes</li>
<li>lprop(): pourcentages lignes</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">cprop</span>(res) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Homme Femme Ensemble
Ouvrier specialise        13.5  10.4  11.8   
Ouvrier qualifie          29.5   6.4  17.0   
Technicien                 9.6   2.5   5.8   
Profession intermediaire  11.1   8.1   9.5   
Cadre                     19.7  13.5  16.4   
Employe                   13.3  56.0  36.3   
Autre                      3.3   3.2   3.2   
Total                    100.0 100.0 100.0   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">lprop</span>(res) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Homme Femme Total
Ouvrier specialise        52.6  47.4 100.0
Ouvrier qualifie          79.7  20.3 100.0
Technicien                76.6  23.4 100.0
Profession intermediaire  53.9  46.1 100.0
Cadre                     55.6  44.4 100.0
Employe                   16.8  83.2 100.0
Autre                     47.1  52.9 100.0
Ensemble                  46.0  54.0 100.0</code></pre>
</div>
</div>
</section>
</section>
<section id="le-package-survey" class="level1">
<h1>Le package <code>survey</code></h1>
<ul>
<li>Plus riche, le package <strong><code>survey</code></strong> permet d’appliquer la pondération, normalisée ou non, à un ensemble plus vaster de fonction.</li>
<li>Pour les modèles, l’application de la pondération normalisée (<strong>obligatoire</strong>) permet d’obtenir une estimation robuste de la variance des paramètres.</li>
<li>La normalisation de la pondération se fait par la création d’une nouvelle variable.</li>
</ul>
<section id="création-de-la-variable-de-pondération-normalisée" class="level2">
<h2 class="anchored" data-anchor-id="création-de-la-variable-de-pondération-normalisée">Création de la variable de pondération normalisée</h2>
<p>On divise tout simplement chaque poids individuel par la moyenne des poids (fonction <code>mean()</code>)</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>creation d'une variable de pondération normalisée</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>hdv2003<span class="sc">$</span>poids_norm<span class="ot">=</span>hdv2003<span class="sc">$</span>poids<span class="sc">/</span><span class="fu">mean</span>(hdv2003<span class="sc">$</span>poids)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Comme la normalisation se fait sur la taille de l’échantillon, la somme des poids normalisés est bien égale à l’effectif de celui-ci</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">sum</span>(hdv2003<span class="sc">$</span>poids_norm)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2000</code></pre>
</div>
</div>
</section>
<section id="design-de-léchantillon" class="level2">
<h2 class="anchored" data-anchor-id="design-de-léchantillon">Design de l’échantillon</h2>
<ul>
<li>On est ici dans la situation la plus simple simple, le design se réduisant à l’application d’un poids d’échantillonage.</li>
<li>Avant d’utiliser la fonction d’analyse on générère un objet renseignant les divers éléments entrant dans le design de l’enquête (ici seulement la variable <em>hdv2003$poids_norm</em>) avec la fonction <strong><code>svydesign</code></strong></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Fonction svydesign</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>dfw <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> hdv2003, <span class="at">weights =</span> <span class="sc">~</span> hdv2003<span class="sc">$</span>poids)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="application-du-design-à-des-fonctions-analytiques" class="level2">
<h2 class="anchored" data-anchor-id="application-du-design-à-des-fonctions-analytiques">Application du design à des fonctions analytiques</h2>
<ul>
<li>On ajoute aux fonctions l’objet généré avec <code>svydesign</code> (ici <strong>dfw</strong>)</li>
</ul>
<p><strong>Tableaux de fréquence</strong></p>
<ul>
<li>Fonction <strong><code>svytable</code></strong></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fréquences pondérées</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">svytable</span>(<span class="sc">~</span>sexe, dfw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>sexe
  Homme   Femme 
5149382 5921844 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">svytable</span>(<span class="sc">~</span> sexe <span class="sc">+</span> qualif, dfw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       qualif
sexe    Ouvrier specialise Ouvrier qualifie Technicien Profession intermediaire
  Homme           532365.8        1163988.6   378956.7                 438737.8
  Femme           479015.0         296252.0   115658.0                 375560.7
       qualif
sexe        Cadre   Employe     Autre
  Homme  779354.9  525068.8  129695.9
  Femme  623574.6 2591911.0  145912.6</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Pourcentages pondérés</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">svytable</span>(<span class="sc">~</span> sexe <span class="sc">+</span> qualif, dfw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Pourcentages pondérés</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">lprop</span>(tab)  <span class="co"># % ligne pondérée</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          qualif
sexe       Ouvrier specialise Ouvrier qualifie Technicien
  Homme     13.5               29.5              9.6     
  Femme     10.4                6.4              2.5     
  Ensemble  11.8               17.0              5.8     
          qualif
sexe       Profession intermediaire Cadre Employe Autre Total
  Homme     11.1                     19.7  13.3     3.3 100.0
  Femme      8.1                     13.5  56.0     3.2 100.0
  Ensemble   9.5                     16.4  36.3     3.2 100.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">cprop</span>(tab)  <span class="co"># % colonne pondérée</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       qualif
sexe    Ouvrier specialise Ouvrier qualifie Technicien Profession intermediaire
  Homme  52.6               79.7             76.6       53.9                   
  Femme  47.4               20.3             23.4       46.1                   
  Total 100.0              100.0            100.0      100.0                   
       qualif
sexe    Cadre Employe Autre Ensemble
  Homme  55.6  16.8    47.1  46.0   
  Femme  44.4  83.2    52.9  54.0   
  Total 100.0 100.0   100.0 100.0   </code></pre>
</div>
</div>
<p><strong>Moyenne pondérée</strong></p>
<ul>
<li>Fonction <code>svymean</code> et <code>svyby</code></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Moyenne pondérée</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>age, dfw)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      mean     SE
age 46.347 0.5284</code></pre>
</div>
</div>
<ul>
<li>Si on souhaite calculer une moyenne par sous groupe, on utilise la fonction <code>svyby</code> à laquelle on ajoute l’argument <code>svymean</code> en option</li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Moyennes pondérées par groupe</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>age, <span class="sc">~</span>sexe, dfw, svymean)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       sexe      age        se
Homme Homme 45.20200 0.7419450
Femme Femme 47.34313 0.7420836</code></pre>
</div>
</div>
<ul>
<li>Modèle logistique avec <code>svyglm</code></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Moyennes pondérées par groupe</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">options</span>(<span class="at">show.signif.stars=</span><span class="cn">FALSE</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">summary</span>(<span class="fu">svyglm</span>(cuisine <span class="sc">~</span> age <span class="sc">+</span> sexe <span class="sc">+</span> occup <span class="sc">+</span> qualif, dfw, <span class="at">family=</span>binomial))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): nombre de succès non entier dans un glm
binomial !</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = cuisine ~ age + sexe + occup + qualif, design = dfw, 
    family = binomial)

Survey design:
svydesign(ids = ~1, data = hdv2003, weights = ~hdv2003$poids)

Coefficients:
                                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                    -0.151065   0.324985  -0.465    0.642
age                            -0.012303   0.006407  -1.920    0.055
sexeFemme                       0.922651   0.160463   5.750 1.06e-08
occupChomeur                    0.344982   0.255175   1.352    0.177
occupEtudiant, eleve           -0.677345   1.124417  -0.602    0.547
occupRetraite                  -0.256705   0.242383  -1.059    0.290
occupRetire des affaires        0.633727   1.100048   0.576    0.565
occupAu foyer                   0.249697   0.286245   0.872    0.383
occupAutre inactif             -0.231741   0.382382  -0.606    0.545
qualifOuvrier qualifie          0.134447   0.252713   0.532    0.595
qualifTechnicien               -0.395892   0.357399  -1.108    0.268
qualifProfession intermediaire  0.220994   0.293482   0.753    0.452
qualifCadre                    -0.265439   0.256451  -1.035    0.301
qualifEmploye                   0.018206   0.222582   0.082    0.935
qualifAutre                    -0.510097   0.401470  -1.271    0.204

(Dispersion parameter for binomial family taken to be 0.9331289)

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Vous pouvez retrouver dans la documentation l’ensemble des fonctions prises en charge.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mthevenin/assistoolsms" data-repo-id="R_kgDOJrhMrg" data-category="General" data-category-id="DIC_kwDOJrhMrs4CW-9c" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->




</body></html>